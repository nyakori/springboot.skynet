<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kaos.his.mapper.InpatientMapper">
    <select id="GetInpatientByPatientNo" resultMap="inpatientMap">
        SELECT
            T1.PATIENT_NO,
            T1.IN_STATE,
            T1.NURSE_CELL_CODE,
            T1.BED_NO,
            T1.IN_DATE,
            T1.OUT_DATE,
            T1.OPER_CODE AS OPER_CODE,
            T2.EMPL_NAME AS OPER_NAME,
            T2.SEX_CODE AS OPER_SEX,
            T2.BIRTHDAY AS OPER_BIRTHDAY,
            T2.IDENNO AS OPER_IDENNO,
            T2.TEL AS OPER_TEL,
            T2.EMAIL AS OPER_EMAIL,
            T2.DEPT_ID AS OPER_DEPT_ID,
            T3.DEPT_NAME AS OPER_DEPT_NAME,
            T3.DEPTOWN AS OPER_DEPTOWN,
            T1.OPER_DATE,
            T1.DEPT_CODE AS PAT_DEPT_ID,
            T4.DEPT_NAME AS PAT_DEPT_NAME,
            T4.DEPTOWN AS PAT_DEPTOWN,
            T1.CARD_NO,
            T5.GCPOUTPATIENT,
            T5.NAME,
            T5.SEX_CODE,
            T5.BIRTHDAY,
            T5.IDENNO,
            NVL(T5.WORK_TEL, NVL(T5.HOME_TEL, T5.LINKMAN_TEL)) AS TEL,
            T5.EMAIL,
            T6.CARD_NO AS HOS_CTF_CARD_NO,
            T6.HAPPEN_NO AS HOS_CTF_HAPPEN_NO,
            T6.OPER_DATE AS HOS_CTF_OPER_DATE,
            T6.NURSE_CELL_CODE AS HOS_CTF_NURSE_CELL_CODE,
            T6.BED_NO AS HOS_CTF_BED_NO,
            T6.PRE_DATE AS HOS_CTF_PRE_DATE,
            T6.PREPAY_COST AS HOS_CTF_PREPAY_COST,
            T6.PRE_STATE AS HOS_CTF_STATE,
            T6.OPER_CODE AS HOS_CTF_OPER_CODE,
            T7.EMPL_NAME AS HOS_CTF_OPER_NAME,
            T7.SEX_CODE AS HOS_CTF_OPER_SEX,
            T7.BIRTHDAY AS HOS_CTF_OPER_BIRTHDAY,
            T7.IDENNO AS HOS_CTF_OPER_IDENNO,
            T7.TEL AS HOS_CTF_OPER_TEL,
            T7.EMAIL AS HOS_CTF_OPER_EMAIL,
            T7.DEPT_ID AS HOS_CTF_OPER_DEPT_CODE,
            T8.DEPT_NAME AS HOS_CTF_OPER_DEPT_NAME,
            T8.DEPTOWN AS HOS_CTF_OPER_DEPTOWN,
            T6.DEPT_CODE AS HOS_CTF_PRE_DEPT_CODE,
            T9.DEPT_NAME AS HOS_CTF_PRE_DEPT_NAME,
            T9.DEPTOWN AS HOS_CTF_PRE_DEPTOWN,
            T6.PREDOCT_CODE AS HOS_CTF_PRE_DOC_CODE,
            T10.EMPL_NAME AS HOS_CTF_PRE_DOC_NAME,
            T10.SEX_CODE AS HOS_CTF_PRE_DOC_SEX,
            T10.BIRTHDAY AS HOS_CTF_PRE_DOC_BIRTHDAY,
            T10.IDENNO AS HOS_CTF_PRE_DOC_IDENNO,
            T10.TEL AS HOS_CTF_PRE_DOC_TEL,
            T10.EMAIL AS HOS_CTF_PRE_DOC_EMAIL,
            T10.DEPT_ID AS HOS_CTF_PRE_DOC_DEPT_CODE,
            T11.DEPT_NAME AS HOS_CTF_PRE_DOC_DEPT_NAME,
            T11.DEPTOWN AS HOS_CTF_PRE_DOC_DEPTOWN
        FROM
            FIN_IPR_INMAININFO T1
            LEFT JOIN DAWN_ORG_EMPL T2 ON T2.EMPL_ID = T1.OPER_CODE
            LEFT JOIN DAWN_ORG_DEPT T3 ON T3.DEPT_ID = T2.DEPT_ID
            LEFT JOIN DAWN_ORG_DEPT T4 ON T4.DEPT_ID = T1.DEPT_CODE
            LEFT JOIN COM_PATIENTINFO T5 ON T5.CARD_NO = T1.CARD_NO
            LEFT JOIN FIN_IPR_PREPAYIN T6 ON T6.CARD_NO = T1.CARD_NO AND T6.HAPPEN_NO = T1.HAPPEN_NO
            LEFT JOIN DAWN_ORG_EMPL T7 ON T7.EMPL_ID = T6.OPER_CODE AND T7.VALID_STATE = '1'
            LEFT JOIN DAWN_ORG_DEPT T8 ON T8.DEPT_ID = T7.DEPT_ID AND T8.VALID_STATE = '1'
            LEFT JOIN DAWN_ORG_DEPT T9 ON T9.DEPT_ID = T6.DEPT_CODE AND T9.VALID_STATE = '1'
            LEFT JOIN DAWN_ORG_EMPL T10 ON T10.EMPL_ID = T6.PREDOCT_CODE AND T10.VALID_STATE = '1'
            LEFT JOIN DAWN_ORG_DEPT T11 ON T11.DEPT_ID = T10.DEPT_ID AND T11.VALID_STATE = '1'
        WHERE
            T1.PATIENT_NO = #{patientNo}
    </select>

    <select id="GetInpatientsByCardNo" resultMap="inpatientMap">
        SELECT
            T1.PATIENT_NO,
            T1.IN_STATE,
            T1.NURSE_CELL_CODE,
            T1.BED_NO,
            T1.IN_DATE,
            T1.OUT_DATE,
            T1.OPER_CODE AS OPER_CODE,
            T2.EMPL_NAME AS OPER_NAME,
            T2.SEX_CODE AS OPER_SEX,
            T2.BIRTHDAY AS OPER_BIRTHDAY,
            T2.IDENNO AS OPER_IDENNO,
            T2.TEL AS OPER_TEL,
            T2.EMAIL AS OPER_EMAIL,
            T2.DEPT_ID AS OPER_DEPT_ID,
            T3.DEPT_NAME AS OPER_DEPT_NAME,
            T3.DEPTOWN AS OPER_DEPTOWN,
            T1.OPER_DATE,
            T1.DEPT_CODE AS PAT_DEPT_ID,
            T4.DEPT_NAME AS PAT_DEPT_NAME,
            T4.DEPTOWN AS PAT_DEPTOWN,
            T1.CARD_NO,
            T5.GCPOUTPATIENT,
            T5.NAME,
            T5.SEX_CODE,
            T5.BIRTHDAY,
            T5.IDENNO,
            NVL(T5.WORK_TEL, NVL(T5.HOME_TEL, T5.LINKMAN_TEL)) AS TEL,
            T5.EMAIL,
            T6.CARD_NO AS HOS_CTF_CARD_NO,
            T6.HAPPEN_NO AS HOS_CTF_HAPPEN_NO,
            T6.OPER_DATE AS HOS_CTF_OPER_DATE,
            T6.NURSE_CELL_CODE AS HOS_CTF_NURSE_CELL_CODE,
            T6.BED_NO AS HOS_CTF_BED_NO,
            T6.PRE_DATE AS HOS_CTF_PRE_DATE,
            T6.PREPAY_COST AS HOS_CTF_PREPAY_COST,
            T6.PRE_STATE AS HOS_CTF_STATE,
            T6.OPER_CODE AS HOS_CTF_OPER_CODE,
            T7.EMPL_NAME AS HOS_CTF_OPER_NAME,
            T7.SEX_CODE AS HOS_CTF_OPER_SEX,
            T7.BIRTHDAY AS HOS_CTF_OPER_BIRTHDAY,
            T7.IDENNO AS HOS_CTF_OPER_IDENNO,
            T7.TEL AS HOS_CTF_OPER_TEL,
            T7.EMAIL AS HOS_CTF_OPER_EMAIL,
            T7.DEPT_ID AS HOS_CTF_OPER_DEPT_CODE,
            T8.DEPT_NAME AS HOS_CTF_OPER_DEPT_NAME,
            T8.DEPTOWN AS HOS_CTF_OPER_DEPTOWN,
            T6.DEPT_CODE AS HOS_CTF_PRE_DEPT_CODE,
            T9.DEPT_NAME AS HOS_CTF_PRE_DEPT_NAME,
            T9.DEPTOWN AS HOS_CTF_PRE_DEPTOWN,
            T6.PREDOCT_CODE AS HOS_CTF_PRE_DOC_CODE,
            T10.EMPL_NAME AS HOS_CTF_PRE_DOC_NAME,
            T10.SEX_CODE AS HOS_CTF_PRE_DOC_SEX,
            T10.BIRTHDAY AS HOS_CTF_PRE_DOC_BIRTHDAY,
            T10.IDENNO AS HOS_CTF_PRE_DOC_IDENNO,
            T10.TEL AS HOS_CTF_PRE_DOC_TEL,
            T10.EMAIL AS HOS_CTF_PRE_DOC_EMAIL,
            T10.DEPT_ID AS HOS_CTF_PRE_DOC_DEPT_CODE,
            T11.DEPT_NAME AS HOS_CTF_PRE_DOC_DEPT_NAME,
            T11.DEPTOWN AS HOS_CTF_PRE_DOC_DEPTOWN
        FROM
            FIN_IPR_INMAININFO T1
            LEFT JOIN DAWN_ORG_EMPL T2 ON T2.EMPL_ID = T1.OPER_CODE
            LEFT JOIN DAWN_ORG_DEPT T3 ON T3.DEPT_ID = T2.DEPT_ID
            LEFT JOIN DAWN_ORG_DEPT T4 ON T4.DEPT_ID = T1.DEPT_CODE
            LEFT JOIN COM_PATIENTINFO T5 ON T5.CARD_NO = T1.CARD_NO
            LEFT JOIN FIN_IPR_PREPAYIN T6 ON T6.CARD_NO = T1.CARD_NO AND T6.HAPPEN_NO = T1.HAPPEN_NO
            LEFT JOIN DAWN_ORG_EMPL T7 ON T7.EMPL_ID = T6.OPER_CODE AND T7.VALID_STATE = '1'
            LEFT JOIN DAWN_ORG_DEPT T8 ON T8.DEPT_ID = T7.DEPT_ID AND T8.VALID_STATE = '1'
            LEFT JOIN DAWN_ORG_DEPT T9 ON T9.DEPT_ID = T6.DEPT_CODE AND T9.VALID_STATE = '1'
            LEFT JOIN DAWN_ORG_EMPL T10 ON T10.EMPL_ID = T6.PREDOCT_CODE AND T10.VALID_STATE = '1'
            LEFT JOIN DAWN_ORG_DEPT T11 ON T11.DEPT_ID = T10.DEPT_ID AND T11.VALID_STATE = '1'
        WHERE
            T1.CARD_NO = #{cardNo}
        ORDER BY
            T1.OPER_DATE ASC
    </select>

    <resultMap id="inpatientMap" type="com.kaos.his.entity.personnel.Inpatient">
        <result column="PATIENT_NO" jdbcType="VARCHAR" property="patientNo"/>
        <result column="IN_STATE" jdbcType="VARCHAR" property="state"/>
        <result column="NURSE_CELL_CODE" jdbcType="VARCHAR" property="nurseCellCode"/>
        <result column="BED_NO" jdbcType="VARCHAR" property="bedNo"/>
        <result column="IN_DATE" jdbcType="VARCHAR" property="inDate"/>
        <result column="OUT_DATE" jdbcType="VARCHAR" property="outDate"/>
        <result column="OPER_DATE" jdbcType="VARCHAR" property="operDate"/>
        <result column="CARD_NO" jdbcType="VARCHAR" property="cardNo"/>
        <result column="GCPOUTPATIENT" jdbcType="VARCHAR" property="gcpOutPatient"/>
        <result column="NAME" jdbcType="VARCHAR" property="name"/>
        <result column="SEX_CODE" jdbcType="VARCHAR" property="sex"/>
        <result column="BIRTHDAY" jdbcType="VARCHAR" property="birthday"/>
        <result column="IDENNO" jdbcType="VARCHAR" property="identityNo"/>
        <result column="TEL" jdbcType="VARCHAR" property="phoneNo"/>
        <result column="EMAIL" jdbcType="VARCHAR" property="email"/>
        <association javaType="com.kaos.his.entity.personnel.Employee" property="operEmployee">
            <result column="OPER_CODE" jdbcType="VARCHAR" property="code"/>
            <result column="OPER_NAME" jdbcType="VARCHAR" property="name"/>
            <result column="OPER_SEX" jdbcType="VARCHAR" property="sex"/>
            <result column="OPER_BIRTHDAY" jdbcType="VARCHAR" property="birthday"/>
            <result column="OPER_IDENNO" jdbcType="VARCHAR" property="identityNo"/>
            <result column="OPER_TEL" jdbcType="VARCHAR" property="phoneNo"/>
            <result column="OPER_EMAIL" jdbcType="VARCHAR" property="email"/>
            <association javaType="com.kaos.his.entity.organization.Department" property="dept">
                <result column="OPER_DEPT_ID" jdbcType="VARCHAR" property="code"/>
                <result column="OPER_DEPT_NAME" jdbcType="VARCHAR" property="name"/>
                <result column="OPER_DEPTOWN" jdbcType="VARCHAR" property="deptOwn"/>
            </association>
        </association>
        <association javaType="com.kaos.his.entity.organization.Department" property="dept">
            <result column="PAT_DEPT_ID" jdbcType="VARCHAR" property="code"/>
            <result column="PAT_DEPT_NAME" jdbcType="VARCHAR" property="name"/>
            <result column="PAT_DEPTOWN" jdbcType="VARCHAR" property="deptOwn"/>
        </association>
        <association javaType="com.kaos.his.entity.credential.HospitalizationCertificate" property="hospitalizationCertificate">
            <result column="HOS_CTF_CARD_NO" jdbcType="VARCHAR" property="cardNo"/>
            <result column="HOS_CTF_HAPPEN_NO" jdbcType="VARCHAR" property="happenNo"/>
            <result column="HOS_CTF_OPER_DATE" jdbcType="VARCHAR" property="operDate"/>
            <result column="HOS_CTF_NURSE_CELL_CODE" jdbcType="VARCHAR" property="preNurseCellCode"/>
            <result column="HOS_CTF_BED_NO" jdbcType="VARCHAR" property="preBedNo"/>
            <result column="HOS_CTF_PRE_DATE" jdbcType="VARCHAR" property="preDate"/>
            <result column="HOS_CTF_PREPAY_COST" jdbcType="VARCHAR" property="preCost"/>
            <result column="HOS_CTF_STATE" jdbcType="VARCHAR" property="state"/>
            <association javaType="com.kaos.his.entity.personnel.Employee" property="operEmployee">
                <result column="HOS_CTF_OPER_CODE" jdbcType="VARCHAR" property="code"/>
                <result column="HOS_CTF_OPER_NAME" jdbcType="VARCHAR" property="name"/>
                <result column="HOS_CTF_OPER_SEX" jdbcType="VARCHAR" property="sex"/>
                <result column="HOS_CTF_OPER_BIRTHDAY" jdbcType="VARCHAR" property="birthday"/>
                <result column="HOS_CTF_OPER_IDENNO" jdbcType="VARCHAR" property="identityNo"/>
                <result column="HOS_CTF_OPER_TEL" jdbcType="VARCHAR" property="phoneNo"/>
                <result column="HOS_CTF_OPER_EMAIL" jdbcType="VARCHAR" property="email"/>
                <association javaType="com.kaos.his.entity.organization.Department" property="dept">
                    <result column="HOS_CTF_OPER_DEPT_CODE" jdbcType="VARCHAR" property="code"/>
                    <result column="HOS_CTF_OPER_DEPT_NAME" jdbcType="VARCHAR" property="name"/>
                    <result column="HOS_CTF_OPER_DEPTOWN" jdbcType="VARCHAR" property="deptOwn"/>
                </association>
            </association>
            <association javaType="com.kaos.his.entity.organization.Department" property="preDept">
                <result column="HOS_CTF_PRE_DEPT_CODE" jdbcType="VARCHAR" property="code"/>
                <result column="HOS_CTF_PRE_DEPT_NAME" jdbcType="VARCHAR" property="name"/>
                <result column="HOS_CTF_PRE_DEPTOWN" jdbcType="VARCHAR" property="deptOwn"/>
            </association>
            <association javaType="com.kaos.his.entity.personnel.Employee" property="preDoctor">
                <result column="HOS_CTF_PRE_DOC_CODE" jdbcType="VARCHAR" property="code"/>
                <result column="HOS_CTF_PRE_DOC_NAME" jdbcType="VARCHAR" property="name"/>
                <result column="HOS_CTF_PRE_DOC_SEX" jdbcType="VARCHAR" property="sex"/>
                <result column="HOS_CTF_PRE_DOC_BIRTHDAY" jdbcType="VARCHAR" property="birthday"/>
                <result column="HOS_CTF_PRE_DOC_IDENNO" jdbcType="VARCHAR" property="identityNo"/>
                <result column="HOS_CTF_PRE_DOC_TEL" jdbcType="VARCHAR" property="phoneNo"/>
                <result column="HOS_CTF_PRE_DOC_EMAIL" jdbcType="VARCHAR" property="email"/>
                <association javaType="com.kaos.his.entity.organization.Department" property="dept">
                    <result column="HOS_CTF_PRE_DOC_DEPT_CODE" jdbcType="VARCHAR" property="code"/>
                    <result column="HOS_CTF_PRE_DOC_DEPT_NAME" jdbcType="VARCHAR" property="name"/>
                    <result column="HOS_CTF_PRE_DOC_DEPTOWN" jdbcType="VARCHAR" property="deptOwn"/>
                </association>
            </association>
        </association>
    </resultMap>
</mapper>